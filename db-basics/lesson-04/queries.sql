-- ================================================================================================
-- Задание №1: Преобразование дат =================================================================
-- ================================================================================================

UPDATE "streams"
SET "started_at" = 
    SUBSTRING("started_at", 7, 4) || '-' ||
    SUBSTRING("started_at", 4, 2) || '-' ||
    SUBSTRING("started_at", 1, 2),
    "finished_at" =
    SUBSTRING("finished_at", 7, 4) || '-' ||
    SUBSTRING("finished_at", 4, 2) || '-' ||
    SUBSTRING("finished_at", 1, 2);

-- ================================================================================================
-- Задание №2: Последний поток ====================================================================
-- ================================================================================================

SELECT "id", "number" FROM "streams" ORDER BY "started_at" DESC LIMIT 1;

-- ================================================================================================
-- Задание №3: Уникальный год =====================================================================
-- ================================================================================================

SELECT DISTINCT SUBSTRING("started_at", 1, 4) AS 'year' FROM "streams";

-- ================================================================================================
-- Задание №4: Количество преподавателей ==========================================================
-- ================================================================================================

SELECT COUNT(*) AS 'total_teachers' FROM "teachers";

-- ================================================================================================
-- Задание №5: Два последних потока ===============================================================
-- ================================================================================================

SELECT "started_at" FROM "streams" ORDER BY "started_at" DESC LIMIT 2;

-- ================================================================================================
-- Задание №6: Средняя успеваемость у преподавателя ===============================================
-- ================================================================================================

-- Вариант-1
SELECT "teacher_id", AVG("performance") AS "perf_avg" FROM "grades" GROUP BY "teacher_id" HAVING "teacher_id" = 1;
-- Вариант-2
SELECT "teacher_id", AVG("performance") AS "perf_avg" FROM "grades" WHERE "teacher_id" = 1;

-- ================================================================================================
-- Задание №7: Преподаватели с успеваемостью ниже 4.8 =============================================
-- ================================================================================================

SELECT "teacher_id" FROM "grades" GROUP BY "teacher_id" HAVING AVG("performance") < 4.8;
